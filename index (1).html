<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <style>
      body {
        font-family: Arial, sans-serif;
        /* è«‹åœ¨é€™è£¡è¨­ç½®æ‚¨çš„èƒŒæ™¯åœ–ç‰‡ URLï¼Œä¸¦ç¢ºä¿åœ–ç‰‡æª”æ¡ˆå·²ä¸Šå‚³åˆ° GitHub å„²å­˜åº« */
        /* ç¯„ä¾‹: background-image: url('images/your-background.jpg'); */
        background-image: url('003.png');
        background-size: cover;
        background-position: top center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        text-align: center;
        padding: 50px;
      }
      /* ç¢ºä¿æ‚¨çš„ spin.mp3 æª”æ¡ˆå’Œ index.html åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¸­ï¼Œæˆ–è€…èª¿æ•´ src è·¯å¾‘ */
      #spinSound {
        display: none; /* å°‡éŸ³é »æ’­æ”¾å™¨éš±è— */
      }

      /* æ–°å¢ï¼šçµæŸéŸ³æ•ˆçš„éŸ³é »æ’­æ”¾å™¨ä¹Ÿéš±è— */
      #finishSound {
        display: none;
      }

      h1, h4 {
        color: rgba(0, 0, 0, 0); /* æ¨™é¡Œéš±è— */
      }

      .slot-machine-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 40px;
        gap: 0px; /* å°‡é€™è£¡æ”¹ç‚º 0pxï¼Œæˆ–ç›´æ¥åˆªé™¤é€™è¡Œ */
      }

      .reel-box {
        width: 250px;
        height: 80px;
        border-radius: 10px;
        font-size: 50px; /* å¢å¤§å­—é«”å¤§å° */
        font-weight: bold;
        display: flex; /* ä¿æŒ flexbox ä½ˆå±€ */
        align-items: center; /* å‚ç›´ç½®ä¸­ */
        justify-content: center; /* é€™è£¡æ”¹å›ç½®ä¸­ */
        /*background-color: rgba(255, 255, 255, 0.8);  åŠé€æ˜ç™½è‰²èƒŒæ™¯ï¼Œè®“å…§å®¹æ›´æ¸…æ™° */
        color: #333; /* æ–‡å­—é¡è‰² */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* è¼•å¾®é™°å½±æ•ˆæœ */
        padding: 0 10px; /* å¢åŠ ä¸€äº›å…§é‚Šè·ï¼Œè®“æ–‡å­—ä¸æœƒå¤ªè²¼é‚Š */
        box-sizing: border-box; /* è®“ padding ä¸æœƒå¢åŠ ç¸½å¯¬åº¦ */
      }

      #areaReel {
        /* ç§»é™¤æˆ–è¨»è§£æ‰æ‰€æœ‰é å³çš„ç‰¹å®šæ¨£å¼ï¼Œè®“å®ƒç¹¼æ‰¿ .reel-box çš„ç½®ä¸­ */
        /* text-align: right; */
        /* justify-content: flex-end; */
        /* padding-right: 0px; */
      }

      #numberReel {
        text-align: left; /* ç·¨è™Ÿé å·¦ */
        justify-content: flex-start; /* åœ¨ flexbox ä¸­é å·¦å°é½Šå…§å®¹ */
      }

      button {
        margin: 10px;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        background-color: #ff9900;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease; /* å¹³æ»‘éæ¸¡æ•ˆæœ */
      }

      button:hover {
        background-color: #e68a00;
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      #resetHistoryButton {
        background-color: #666;
      }
      #resetHistoryButton:hover {
        background-color: #555;
      }

      #restartButton {
        background-color: #0066cc;
      }
      #restartButton:hover {
        background-color: #005bb5;
      }

      #result {
        margin-top: 30px;
        font-size: 18px;
        color: #333;
        font-weight: bold; /* åŠ ç²—çµæœæ–‡å­— */
        /* å› ç‚ºæ‚¨ä¸å†ä½¿ç”¨æ­¤å€å¡Šï¼Œæ‚¨å¯ä»¥è€ƒæ…®å°‡å…¶éš±è—æˆ–å®Œå…¨ç§»é™¤ */
        /* display: none; */ 
      }

      #result b {
        color: #003366;
      }

      #history {
        margin-top: 40px;
        text-align: left;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
        background: rgba(255, 255, 255, 0.9); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #ccc;
        min-height: 100px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow-y: auto; /* æ­·å²è¨˜éŒ„è¶…å‡ºç‰ˆé¢æ™‚å¯æ»¾å‹• */
        max-height: 250px; /* è¨­ç½®æ­·å²è¨˜éŒ„çš„æœ€å¤§é«˜åº¦ */
      }

      #history div {
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <h1>1</h1>
    <h1>2</h1>
    <h1>2</h1>
        <h1>2</h1>

    <div class="slot-machine-wrapper">
      <div id="areaReel" class="reel-box">--</div>
      <div id="numberReel" class="reel-box">--</div>
    </div>
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <audio id="spinSound" src="002.mp3" preload="auto"></audio>

    <audio id="finishSound" src="002.mp3" preload="auto"></audio>

    <button id="drawButton" onclick="startDraw()">é–‹å§‹æŠ½é¸</button>
    <button id="retryNumberButton" onclick="retryNumber()" disabled>é‡æŠ½ç›®å‰ç·¨è™Ÿ</button>
    <button id="resetHistoryButton" onclick="resetHistory()">æ¸…é™¤ç´€éŒ„</button>
    <button id="restartButton" onclick="restartAll()">ğŸ”„ é‡æ–°é–‹å§‹</button>

    <div id="result"></div> 
    <div id="history"><strong>ğŸ¯ æŠ½é¸ç´€éŒ„ï¼š</strong></div>

    <script>
      // === æ‚¨çš„å€åŸŸå’Œç·¨è™Ÿè³‡æ–™å·²ç›´æ¥åµŒå…¥æ–¼æ­¤ ===
      let areaMap = {
         "ä¸­å’Œ": [
          "001å€", "002å€", "003å€", "004å€", "005å€", "006å€", "007å€", "008å€",
          "010å€", "011å€", "012å€", "013å€", "014å€", "015å€", "017å€", "018å€", "019å€",
          "020å€", "021å€", "022å€", "023å€", "024å€", "025å€", "026å€", "027å€",
          "028å€", "029å€", "030å€", "031å€", "032å€", "033å€", "034å€", "035å€",
          "037å€", "039å€", "040å€", "041å€", "042å€", "044å€",
          "045å€", "046å€", "047å€", "048å€", "049å€", "050å€", "051å€", "052å€", "053å€",
          "055å€", "056å€", "058å€", "061å€", "062å€", "063å€",
          "064å€", "065å€", "066å€",
          "072å€", "073å€", "075å€", "077å€", "078å€", "079å€", "080å€", "081å€",
          "085å€", "086å€", "087å€", "088å€", "089å€", "091å€", "092å€", "093å€",
          "097å€", "098å€", "099å€",
          "101å€", "103å€", "107å€",
          "110å€", "114å€", "115å€",
          "118å€", "119å€", ],
        "å´‡æ­£": ["å€"], // ç‰¹æ®Šè™•ç†ï¼šåªæœ‰ã€Œå€ã€å­—ï¼Œè¡¨ç¤ºæ²’æœ‰æ•¸å­—ç·¨è™Ÿ
        "è³¢å¾·": ["001å€"],
        
        /*//å´‡è¯ç­
        "ç¬¬ä¸€çµ„": ["æ¥Šé¨å„ª","å‘¨å­Ÿå½¥","å¾æ˜é¡","ä¸˜ä»Šç¥","å¼µç­ æ¬£","è¨±æƒ èŒ¹","æ—å©‰çª","é™³å§µè«­","æ—éº—é¦™","é™³æ˜±å¦®",],
        "ç¬¬äºŒçµ„": ["å¼µèªŒé€¸","è¶™ç¶­ä»","å»–é–‹ä¿Š","æ›¾ç¬é›¯","ç‹ç‘œå©·","å¼µé›…åª—","èŒ…ä¹ƒæ–‡","ç« æ˜¥ç‡•","å¼µèªè±",],
        "ç¬¬ä¸‰çµ„": ["å³å’Œå³°","å¾ä¸è§€","å¼µå¸­å½¬","æœ±æ°¸å‹¤","å¼µæ·‘å¦‚","å‘¨å¹¼å©·","è¶™æ•æƒ ","å‘¨èŠ·è±","éƒ­ç§€å¦¹","å®‹æ²¾å…‹å¨œ",],
        "ç¬¬å››çµ„": ["è³´è–è³¢","é¡éŠ˜å±±","æ¬’å°šæ–‡","ææ°¸åº·","ææŸ”æ¾¤","èƒ¡ç‰è","æ›¾ç€šå„€","å³æ€¡æƒ ","é»ç§€ç²","å»–å¦ƒç¾","è¬äº¦æ±¶",],
        "ç¬¬äº”çµ„": ["é™³å½¥ä¸","å¾ä¸è³¦","é™³æ°‘å£¯","ç‹æ¼¢æ¼¢","è¬æƒ å®‡","é™³ä½©ç²","é­åŸè»’","é„­ç§€å¨Ÿ","å¼µå®‡ç‘„","å‘¨ äº‘","å»–æ†“èŠ³",],
        "ç¬¬å…­çµ„": ["ç¾…æ–‡æˆ","å§šå¥•ç¦","ç‹è©©è˜‹","é™³æ€¡äº˜","æ—è‰å¨Ÿ","æ›¾æ–‡å¦¡","å³æ˜“éœ“","ä½•èªŒèƒ",],
        "ç¬¬ä¸ƒçµ„": ["ç‹åšæ¯…","é™³èˆˆé”","è˜‡å§µç‘„","å‘¨è‚²å›","è¬ç²ç","ç‹æ°¸ç","æ—ç§€ç¾š","æç¸ˆå®£","å¼µæ¢…è˜­",],
        "ç¬¬å…«çµ„": ["æ´ªéŠ˜é´»","é»ƒå£«è±ª","å‚…åœ‹æˆ","é»ƒç›¸ç³","é™³æƒ ç´”","åº·è‹¥å©·","ç‹ç¾éº—","é‚µç§€ç‰","éƒ­å€¢å¦¤","æœ±ç¿Šè±",],
        "ç¬¬ä¹çµ„": ["é„§åœéŠ˜","è¬å®—å®","æ¥Šä¿Šå®","æœ±å“é ¤","è˜‡æ©è«„","å‘¨æ„«ç¦","è•­ç‰å©‰","æ—éƒèŠ³","æ—æƒ ç‰",],
        "ç¬¬åçµ„": ["äºä¹ƒè¯","æ—èˆˆæ´¸","é»ƒæƒ å¨‰","é™³æ€¡ç‘„","æ—æ·‘æ£±","åŠ‰ä½³ç²","æ´ªç‘œå©•","é»ƒç‘©ç",],
        "ç¥å·": ["é™¸å’¸æ»¿","å¼µèŒ—é›„","é„‰è¯å¦¹","é˜®å©‰å","ç‹éŸµè²½","ç‹æŒ¯æ¢…","æ¢é•·ç§€","é»ƒç‡¦èŠ¬","å³ç§€è‹±","å³éº—ç²","æ—æ¡‚è‹±","è¬å·§ç§€","é«˜è‰ç²","é»ƒè—ç","è¬æ‹›æ²»","ç‹ ç©",
"æ—è—å¨Ÿ","å•† ç‡•","æ ç¾¤","æå½±æ³¢","æ­¦ æ•","è«æ¢…æ¸…","è¦ƒè“®ç§‹","é»ƒå¤éœ–","åŠ‰ èŠ¬","æ½˜æŒ¯è¯",],*/
      };

      // ç›´æ¥ä½¿ç”¨æ‚¨æä¾›çš„ areaNames
      let areaNames = [
        //"ç¬¬ä¸€çµ„","ç¬¬äºŒçµ„","ç¬¬ä¸‰çµ„","ç¬¬å››çµ„","ç¬¬äº”çµ„","ç¬¬å…­çµ„","ç¬¬ä¸ƒçµ„","ç¬¬å…«çµ„","ç¬¬ä¹çµ„","ç¬¬åçµ„","ç¥å·",
        "ä¸­å’Œ", "å´‡æ­£", "è³¢å¾·",
      ];

      // å°‡ areaMap è£¡çš„æ¯å€‹ç·¨è™Ÿåˆ—è¡¨é€²è¡Œæ’åº (å¯é¸ï¼Œä½†è®“æŠ½é¸æ›´æœ‰åº)
      for (const area in areaMap) {
        areaMap[area].sort();
      }
      // ===================================

      let drawnMap = {}; // ç”¨æ–¼è¨˜éŒ„å·²æŠ½å‡ºçš„ç·¨è™Ÿ
      let lastSelectedArea = null; // è¨˜éŒ„ä¸Šæ¬¡æŠ½ä¸­çš„å€åŸŸ
      const spinSound = document.getElementById('spinSound'); // ç²å–è½‰å‹•éŸ³é »å…ƒç´ 
      const finishSound = document.getElementById('finishSound'); // æ–°å¢ï¼šç²å–çµæŸéŸ³é »å…ƒç´ 

      window.onload = () => {
        // é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ–æ“ä½œ
      };

      /**
       * æ’­æ”¾è½‰å‹•éŸ³æ•ˆã€‚
       */
      function playSpinSound() {
        if (spinSound) {
          spinSound.currentTime = 0; // æ¯æ¬¡æ’­æ”¾å‰é‡ç½®åˆ°é–‹é ­
          spinSound.play().catch(e => console.log("è½‰å‹•éŸ³é »æ’­æ”¾å¤±æ•—:", e)); 
        }
      }

      /**
       * åœæ­¢è½‰å‹•éŸ³æ•ˆã€‚
       */
      function stopSpinSound() {
        if (spinSound) {
          spinSound.pause(); // æš«åœæ’­æ”¾
          spinSound.currentTime = 0; // é‡ç½®åˆ°é–‹é ­
        }
      }

      /**
       * æ’­æ”¾çµæŸéŸ³æ•ˆçš„ç‰¹å®šå€æ®µã€‚
       * @param {number} startTime - éŸ³æ•ˆé–‹å§‹æ’­æ”¾çš„ç§’æ•¸ã€‚
       * @param {number} duration - éŸ³æ•ˆæŒçºŒæ’­æ”¾çš„ç§’æ•¸ã€‚
       */
      function playFinishSound(startTime, duration) {
        if (finishSound) {
          finishSound.currentTime = startTime; // è¨­å®šæ’­æ”¾èµ·é» (ç§’)
          finishSound.play().catch(e => console.log("çµæŸéŸ³é »æ’­æ”¾å¤±æ•—:", e));

          // è¨­å®šåœ¨æŒ‡å®šç§’æ•¸å¾Œåœæ­¢
          setTimeout(() => {
            finishSound.pause();
            finishSound.currentTime = 0; // é‡ç½®åˆ°é–‹é ­
          }, duration * 1000); // duration æ˜¯ç§’æ•¸ï¼Œæ‰€ä»¥è¦ä¹˜ä»¥ 1000 è½‰æ›ç‚ºæ¯«ç§’
        }
      }

      /**
       * é–‹å§‹æŠ½é¸æµç¨‹ã€‚
       */
      function startDraw() {
        document.getElementById('drawButton').disabled = true;
        document.getElementById('retryNumberButton').disabled = true;
        document.getElementById('result').innerHTML = ''; 
        document.getElementById('areaReel').innerText = '--';
        document.getElementById('numberReel').innerText = '--';
        playSpinSound(); // é–‹å§‹æ’­æ”¾è½‰å‹•éŸ³æ•ˆ
        spinAreaFirst();
      }

      /**
       * è½‰å‹•å€åŸŸè¼ªç›¤ã€‚
       */
      function spinAreaFirst() {
        // éæ¿¾å‡ºé‚„æœ‰æœªæŠ½å‡ºç·¨è™Ÿçš„å€åŸŸ
        const availableAreas = areaNames.filter(area => {
          const areaNumbers = areaMap[area];
          if (!areaNumbers || areaNumbers.length === 0) {
            return false; // å¦‚æœé€™å€‹å€åŸŸæ ¹æœ¬æ²’æœ‰å°æ‡‰çš„ç·¨è™Ÿé™£åˆ—ï¼Œæˆ–é™£åˆ—æ˜¯ç©ºçš„ï¼Œå‰‡ä¸åƒèˆ‡æŠ½é¸
          }

          // ç‰¹æ®Šè™•ç† "å´‡æ­£" é€™ç¨®åªæœ‰ä¸€å€‹ "å€" çš„æƒ…æ³
          if (areaNumbers.length === 1 && areaNumbers[0] === 'å€') {
            return !drawnMap[area] || drawnMap[area].length === 0; // ç¢ºä¿åªè¢«æŠ½ä¸€æ¬¡
          }

          // å°æ–¼æœ‰å¯¦éš›æ•¸å­—ç·¨è™Ÿçš„å€åŸŸ
          if (!drawnMap[area]) return true; // å¦‚æœè©²å€åŸŸé‚„æ²’æœ‰è¢«æŠ½éä»»ä½•ç·¨è™Ÿï¼Œå‰‡å¯ç”¨
          return drawnMap[area].length < areaNumbers.length; // å¦‚æœè©²å€åŸŸé‚„æœ‰æœªæŠ½å‡ºçš„ç·¨è™Ÿï¼Œå‰‡å¯ç”¨
        });

        if (availableAreas.length === 0) {
          alert("æ‰€æœ‰å€åŸŸç·¨è™Ÿéƒ½æŠ½å®Œäº†ï¼Œè«‹æŒ‰ã€Œé‡æ–°é–‹å§‹ã€é‡æ–°æŠ½é¸ï¼");
          document.getElementById('drawButton').disabled = false;
          stopSpinSound(); // åœæ­¢è½‰å‹•éŸ³æ•ˆ
          return;
        }

        const areaReel = document.getElementById('areaReel');
        let spinDuration = 2000 + Math.random() * 1000; // éš¨æ©Ÿè½‰å‹•æ™‚é–“ (2ç§’åˆ°3ç§’)
        let start = null; // å‹•ç•«é–‹å§‹æ™‚é–“

        function animate(time) {
          if (!start) start = time;
          const progress = time - start;
          const i = Math.floor(progress / 80) % availableAreas.length; // æ¯80æ¯«ç§’æ›´æ›ä¸€æ¬¡é¡¯ç¤ºçš„å€åŸŸ
          areaReel.innerText = availableAreas[i];

          if (progress < spinDuration) {
            requestAnimationFrame(animate); // ç¹¼çºŒå‹•ç•«
          } else {
            // å‹•ç•«çµæŸï¼Œé¸å–æœ€çµ‚å€åŸŸ
            const finalArea = availableAreas[Math.floor(Math.random() * availableAreas.length)];
            areaReel.innerText = finalArea;
            lastSelectedArea = finalArea; // è¨˜éŒ„æœ€çµ‚é¸ä¸­çš„å€åŸŸ
            
            stopSpinSound(); // åœæ­¢è½‰å‹•éŸ³æ•ˆ
            
            spinNumber(finalArea); // æ¥è‘—è½‰å‹•ç·¨è™Ÿ
          }
        }

        requestAnimationFrame(animate); // å•Ÿå‹•å‹•ç•«
      }

      /**
       * è½‰å‹•ç·¨è™Ÿè¼ªç›¤ã€‚
       * @param {string} area - ç•¶å‰é¸ä¸­çš„å€åŸŸåç¨±ã€‚
       */
      function spinNumber(area) {
        const allNumbersWithSuffix = areaMap[area]; // é€™è£¡çš„ç·¨è™ŸåŒ…å«ã€Œå€ã€å­—
        const numberReel = document.getElementById('numberReel');

        // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœè©²å€åŸŸæ²’æœ‰ä»»ä½•å¯¦éš›æ•¸å­—ç·¨è™Ÿå¯ä¾›æŠ½é¸ (ä¾‹å¦‚"å´‡æ­£"åªæœ‰ã€Œå€ã€å­—)
        if (!allNumbersWithSuffix || allNumbersWithSuffix.length === 0 || (allNumbersWithSuffix.length === 1 && allNumbersWithSuffix[0] === 'å€')) {
          const displayValue = (allNumbersWithSuffix && allNumbersWithSuffix[0] === 'å€') ? 'å€' : '--'; // é‡å°ã€Œå´‡æ­£å€ã€é¡¯ç¤ºã€Œå€ã€å­—
          numberReel.innerText = displayValue; // é¡¯ç¤ºã€Œå€ã€å­—

          // å°‡é€™å€‹å–®ä¸€å–®ä½æ¨™è¨˜ç‚ºå·²æŠ½å–ï¼Œé€™æ¨£ä¸‹æ¬¡å°±ä¸æœƒå†æŠ½åˆ°
          if (!drawnMap[area]) drawnMap[area] = [];
          if (!drawnMap[area].includes('å€')) { // ç¢ºä¿åªæ·»åŠ ä¸€æ¬¡ï¼Œä¸¦å°‡æ¨™è¨˜å¾'å–®ä¸€å–®ä½'æ”¹ç‚º'å€'
              drawnMap[area].push('å€');
          }

          document.getElementById('history').innerHTML += `
            <div>ğŸ”¹ <b>${area}</b> (å€)</div> `;
          const historyDiv = document.getElementById('history');
          historyDiv.scrollTop = historyDiv.scrollHeight;

          document.getElementById('drawButton').disabled = false;
          document.getElementById('retryNumberButton').disabled = true; // å–®ä¸€å–®ä½ç„¡æ³•é‡æŠ½
          stopSpinSound(); // åœæ­¢è½‰å‹•éŸ³æ•ˆ
          // å–®ä¸€å–®ä½æ²’æœ‰ç·¨è™Ÿè½‰å‹•ï¼Œæ‰€ä»¥é€™è£¡ä¸éœ€è¦æ’­æ”¾çµæŸéŸ³æ•ˆ
          return;
        }

        if (!drawnMap[area]) drawnMap[area] = []; // å¦‚æœè©²å€åŸŸé‚„æ²’æœ‰è¨˜éŒ„ï¼Œå‰‡åˆå§‹åŒ–ç‚ºç©ºé™£åˆ—

        // éæ¿¾å‡ºè©²å€åŸŸä¸­é‚„æœªè¢«æŠ½å‡ºçš„ç·¨è™Ÿ (å¸¶æœ‰ã€Œå€ã€å­—)
        const remainingNumbersWithSuffix = allNumbersWithSuffix.filter(n => !drawnMap[area].includes(n));

        if (remainingNumbersWithSuffix.length === 0) {
          numberReel.innerText = 'å·²æŠ½å®Œ';
          document.getElementById('result').innerHTML = `âš ï¸ <b>${area}</b> çš„ç·¨è™Ÿå·²å…¨éƒ¨æŠ½å®Œï¼Œè«‹æŒ‰ã€Œé‡æ–°é–‹å§‹ã€é‡ç½®`;
          document.getElementById('drawButton').disabled = false;
          document.getElementById('retryNumberButton').disabled = true; // è©²å€åŸŸå·²æŠ½å®Œï¼Œç„¡æ³•é‡æŠ½
          stopSpinSound(); // åœæ­¢è½‰å‹•éŸ³æ•ˆ
          return;
        }

        // å¦‚æœæ‚¨å¸Œæœ›ç·¨è™Ÿè½‰å‹•æ™‚ä¹Ÿæœ‰è½‰å‹•éŸ³æ•ˆï¼Œè«‹å–æ¶ˆè¨»è§£ä¸‹é¢é€™è¡Œ
         playSpinSound(); 
        let spinDuration = 2000 + Math.random() * 1000; // éš¨æ©Ÿè½‰å‹•æ™‚é–“ (2ç§’åˆ°3ç§’)
        let start = null; // å‹•ç•«é–‹å§‹æ™‚é–“

        function animate(time) {
          if (!start) start = time;
          const progress = time - start;
          const i = Math.floor(progress / 80) % remainingNumbersWithSuffix.length; // æ¯80æ¯«ç§’æ›´æ›ä¸€æ¬¡é¡¯ç¤ºçš„ç·¨è™Ÿ
          numberReel.innerText = remainingNumbersWithSuffix[i]; // é¡¯ç¤ºæ™‚ä¿ç•™ã€Œå€ã€å­—

          if (progress < spinDuration) {
            requestAnimationFrame(animate); // ç¹¼çºŒå‹•ç•«
          } else {
            // å‹•ç•«çµæŸï¼Œé¸å–æœ€çµ‚ç·¨è™Ÿ (å¸¶æœ‰ã€Œå€ã€å­—)
            const finalNumberWithSuffix = remainingNumbersWithSuffix[Math.floor(Math.random() * remainingNumbersWithSuffix.length)];
            
            numberReel.innerText = finalNumberWithSuffix; // é¡¯ç¤ºæ™‚ä¿ç•™ã€Œå€ã€å­—
            drawnMap[area].push(finalNumberWithSuffix); // å°‡æŠ½å‡ºçš„ç·¨è™Ÿï¼ˆå¸¶æœ‰ã€Œå€ã€å­—ï¼‰åŠ å…¥è¨˜éŒ„

            // åœ¨æ­·å²è¨˜éŒ„ä¸­é¡¯ç¤º
            document.getElementById('history').innerHTML += `
              <div>ğŸ”¹ <b>${area}</b> <b>${finalNumberWithSuffix}</b></div>
            `;
            // ä½¿æ­·å²è¨˜éŒ„æ»¾å‹•åˆ°åº•éƒ¨
            const historyDiv = document.getElementById('history');
            historyDiv.scrollTop = historyDiv.scrollHeight;

            document.getElementById('drawButton').disabled = false; // å•Ÿç”¨é–‹å§‹æŠ½é¸æŒ‰éˆ•
            document.getElementById('retryNumberButton').disabled = false; // å•Ÿç”¨é‡æŠ½æŒ‰éˆ•
            stopSpinSound(); // åœæ­¢è½‰å‹•éŸ³æ•ˆ

            // æ’­æ”¾çµæŸéŸ³æ•ˆã€‚æ‚¨å¯ä»¥èª¿æ•´é€™å…©å€‹åƒæ•¸ï¼š
            // ç¬¬ä¸€å€‹åƒæ•¸ï¼šéŸ³æ•ˆé–‹å§‹æ’­æ”¾çš„ç§’æ•¸ (ä¾‹å¦‚ 1.5 ä»£è¡¨å¾ finish.mp3 çš„ç¬¬ 1.5 ç§’é–‹å§‹)
            // ç¬¬äºŒå€‹åƒæ•¸ï¼šéŸ³æ•ˆæŒçºŒæ’­æ”¾çš„ç§’æ•¸ (ä¾‹å¦‚ 3 ä»£è¡¨æ’­æ”¾ 3 ç§’)
            playFinishSound(9, 2); 
          }
        }

        requestAnimationFrame(animate); // å•Ÿå‹•å‹•ç•«
      }

      /**
       * é‡æŠ½ç›®å‰ç·¨è™Ÿã€‚
       */
      function retryNumber() {
        if (!lastSelectedArea) {
          alert("è«‹å…ˆæŠ½å‡ºä¸€å€‹å€åŸŸï¼");
          return;
        }
        // å¦‚æœ lastSelectedArea æ˜¯æ²’æœ‰æ•¸å­—ç·¨è™Ÿçš„å–®ä¸€å–®ä½ï¼Œå‰‡ä¸èƒ½é‡æŠ½
        const areaNumbers = areaMap[lastSelectedArea];
        if (!areaNumbers || areaNumbers.length === 0 || (areaNumbers.length === 1 && areaNumbers[0] === 'å€')) {
            alert("æ­¤å–®ä½æ²’æœ‰ç·¨è™Ÿå¯ä¾›é‡æŠ½ã€‚");
            return;
        }

        document.getElementById('result').innerHTML = ''; 
        document.getElementById('numberReel').innerText = '--';
        document.getElementById('drawButton').disabled = true;
        document.getElementById('retryNumberButton').disabled = true;

        // åœ¨é‡æŠ½ä¹‹å‰ï¼Œå°‡ä¸Šæ¬¡æŠ½å‡ºçš„ç·¨è™Ÿå¾ drawnMap ä¸­ç§»é™¤ï¼Œä½¿å…¶å¯ä»¥å†æ¬¡è¢«é¸ä¸­
        if (drawnMap[lastSelectedArea] && drawnMap[lastSelectedArea].length > 0) {
            drawnMap[lastSelectedArea].pop(); // ç§»é™¤æœ€å¾Œä¸€å€‹å…ƒç´ ï¼ˆåŒ…å«ã€Œå€ã€å­—å°¾çš„ç·¨è™Ÿï¼‰
            // åŒæ­¥ç§»é™¤æ­·å²è¨˜éŒ„ä¸­çš„æœ€å¾Œä¸€å€‹é …ç›®
            const historyDiv = document.getElementById('history');
            if (historyDiv.lastElementChild && historyDiv.lastElementChild.tagName === 'DIV') {
                historyDiv.removeChild(historyDiv.lastElementChild);
            }
        }
        // é‡æŠ½æ™‚ï¼Œç¢ºä¿åœæ­¢çµæŸéŸ³æ•ˆï¼Œé¿å…å¤šå€‹éŸ³æ•ˆç–ŠåŠ 
        if (finishSound) {
          finishSound.pause();
          finishSound.currentTime = 0;
        }
        spinNumber(lastSelectedArea); // é‡æ–°è½‰å‹•ç·¨è™Ÿ
      }

      /**
       * æ¸…é™¤æ­·å²ç´€éŒ„ã€‚
       */
      function resetHistory() {
        document.getElementById('history').innerHTML = '<strong>ğŸ¯ æŠ½é¸ç´€éŒ„ï¼š</strong>';
      }

      /**
       * é‡ç½®æ‰€æœ‰æŠ½çè³‡æ–™ï¼Œé‡æ–°é–‹å§‹ã€‚
       */
      function restartAll() {
        drawnMap = {}; // æ¸…ç©ºæ‰€æœ‰å·²æŠ½å‡ºçš„è¨˜éŒ„
        lastSelectedArea = null; // æ¸…ç©ºä¸Šæ¬¡é¸ä¸­çš„å€åŸŸ
        document.getElementById('areaReel').innerText = '--';
        document.getElementById('numberReel').innerText = '--';
        document.getElementById('result').innerHTML = ''; // ç¢ºä¿é‡æ–°é–‹å§‹æ™‚ä¹Ÿæ¸…ç©º
        document.getElementById('history').innerHTML = '<strong>ğŸ¯ æŠ½é¸ç´€éŒ„ï¼š</strong>';
        document.getElementById('drawButton').disabled = false; // å•Ÿç”¨é–‹å§‹æŠ½é¸æŒ‰éˆ•
        document.getElementById('retryNumberButton').disabled = true; // ç¦ç”¨é‡æŠ½æŒ‰éˆ•
        alert("æ‰€æœ‰è³‡æ–™å·²é‡ç½®ï¼Œé‡æ–°é–‹å§‹æŠ½é¸ï¼");

        // é‡æ–°é–‹å§‹æ™‚ï¼Œåœæ­¢æ‰€æœ‰éŸ³æ•ˆ
        stopSpinSound();
        if (finishSound) {
          finishSound.pause();
          finishSound.currentTime = 0;
        }
      }
    </script>
  </body>
</html>
